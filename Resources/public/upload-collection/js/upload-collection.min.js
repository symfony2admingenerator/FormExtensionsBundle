$.widget("blueimp.fileupload",$.blueimp.fileupload,{_cleanInputsFile:function(){this.options.uploadOnSubmit&&this.options.fileInput.prop("value","")},_initButtonBarEventHandlers:function(){var e=this,i=this.element.find(".fileupload-buttonbar"),t=this.options.filesContainer;this._on(i.find(".start"),{click:function(i){i.preventDefault(),t.find("button.start").click(),e._cleanInputsFile()}}),this._on(i.find(".cancel"),{click:function(i){i.preventDefault(),t.find("button.cancel").click(),t.find("button.remove").click(),e._cleanInputsFile()}}),this._on(i.find(".delete"),{click:function(n){n.preventDefault(),confirm(e.options.messages.confirmBatchDelete)&&(t.find("input[name=delete]:checked").parent().siblings("button").click(),i.find(".toggle").prop("checked",!1))}}),this._on(i.find(".toggle"),{change:function(e){t.find("input[name=delete]").prop("checked",$(e.currentTarget).is(":checked"))}})},_cancelWaitingUploads:function(){this.options.filesContainer.find(".cancel").click()},_uploadCompleted:function(e,i){i.files&&(this._renderPreviews(i),i.context.find("button.remove").on("click",function(e){e.preventDefault(),i.context.find(".form input[type=checkbox].remove").prop("checked",!0).end().hide()}))},_initEventHandlers:function(){this._super(),this._on(this.options.uploadOnSubmit?{fileuploadchange:this._cancelWaitingUploads}:{fileuploadcompleted:this._uploadCompleted})}}),function(e,i,t){function n(i,t){this.element=i,this.options=e.extend({},s,t),this._defaults=s,this._name=o,this._init()}var o="uploadCollection",s=(i.document,{sortable:!1,sortable_field:"position",messages:{maxNumberOfFiles:"Maximum number of files exceeded",acceptFileTypes:"File type not allowed",maxFileSize:"File is too big",minFileSize:"File is too small",confirmBatchDelete:"Are you sure you want to delete all selected elements?"},javascript:function(){}});n.prototype={_init:function(){var i=this;this.$element=e(this.element),this.$widgetContainer=e("#"+this.element.id+"_widget_container"),this.$filesContainer=e("#"+this.element.id+"_files_list"),this.$progressBarContainer=this.$widgetContainer.find(".fileupload-progressbar"),this.waitingToUpload=0,this.submitOnFinish=!1,this.$widgetContainer.fileupload({messages:this.options.messages,fileInput:this.$element,replaceFileInput:!1,uploadTemplateId:this.element.id+"_upload_template",downloadTemplateId:this.element.id+"_download_template",filesContainer:this.$filesContainer,dropZone:this.$widgetContainer,pasteZone:this.$widgetContainer,maxNumberOfFiles:this.options.maxNumberOfFiles,maxFileSize:this.options.maxFileSize,minFileSize:this.options.minFileSize,acceptFileTypes:this.options.acceptFileTypes,previewAsCanvas:this.options.previewAsCanvas,prependFiles:this.options.prependFiles,previewSourceFileTypes:this.options.previewSourceFileTypes,previewSourceMaxFileSize:this.options.previewSourceMaxFileSize,previewMaxWidth:this.options.previewMaxWidth,previewMaxHeight:this.options.previewMaxHeight,autoUpload:this.options.autoUpload,url:this.options.urlUpload,uploadOnSubmit:!this.options.autoUpload&&!this.options.urlUpload,progressall:function(){},start:function(){i.$progressBarContainer.show()},stop:function(){i.$progressBarContainer.hide()}}),this.options.urlUpload&&(this.$widgetContainer.bind("fileuploadadd",function(e,t){t.formData={propertyPath:t.paramName},i.waitingToUpload+=1}).bind("fileuploadcompleted",function(){i.waitingToUpload-=1}).bind("fileuploadfailed",function(){i.waitingToUpload-=1}).bind("fileuploadfinished",function(){0==i.waitingToUpload&&i.submitOnFinish&&i.$element.parents("form").submit()}),this.$element.parents("form").on("submit",function(e){return i.waitingToUpload>0?(i.submitOnFinish=!0,i.$element.parents("form").find(".fileupload-buttonbar .start").click(),void e.preventDefault()):void i.$element.remove()})),this.options.sortable&&e("#"+this.element.id+"_files_list").sortable({helper:function(i,t){return t.children().each(function(){e(this).css("width",e(this).width())}),t},handle:".handle",cursor:"move",items:"> tr.template-download",axis:"y",forceHelperSize:!0,forcePlaceholderSize:!0,placeholder:"sortable-placeholder",over:function(){var e=i.$filesContainer.find("tr.ui-sortable-helper"),t=i.$filesContainer.find("tr.sortable-placeholder");t.css("height",e.height())},update:function(t,n){n.item.children().each(function(){e(this).css("width","")}),e('[id^="'+i.element.id+'"][id$="'+i.options.sortable_field+'"]').each(function(i){e(this).val(i)})},start:function(t,n){i.ckeConfigs=[],e("textarea",n.item).each(function(){var t=e(this).attr("id");if(CKEDITOR.instances[t]){var n=e(this).next(".cke").clone().addClass("cloned");i.ckeConfigs[t]=CKEDITOR.instances[t].config,CKEDITOR.instances[t].destroy(),e(this).hide().after(n)}})},stop:function(t,n){e("textarea",n.item).each(function(){var t=e(this).attr("id");i.ckeConfigs[t]&&(CKEDITOR.replace(t,i.ckeConfigs[t]),e(this).next(".cloned").remove())})}})},loadFiles:function(e){this.$widgetContainer.fileupload("option","done").call(this.$widgetContainer,null,{result:e})}},e.fn[o]=function(i){var s=arguments;if(i===t||"object"==typeof i)return this.each(function(){e.data(this,"plugin_"+o)||e.data(this,"plugin_"+o,new n(this,i))});if("string"==typeof i&&"_"!==i[0]&&"init"!==i){var l;return this.each(function(){var t=e.data(this,"plugin_"+o);t instanceof n&&"function"==typeof t[i]&&(l=t[i].apply(t,Array.prototype.slice.call(s,1))),"destroy"===i&&e.data(this,"plugin_"+o,null)}),l!==t?l:this}}}(jQuery,window);
