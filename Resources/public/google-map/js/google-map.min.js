!function(t,e,o){function n(e,o){this.element=e;this.options=t.extend({search_input_el:null,search_action_el:null,search_error_el:null,current_position_el:null,default_lat:51.5,default_lng:-.1245,default_zoom:5,lat_field:null,lng_field:null,callback:function(){},error_handler:function(){}},r,o),this._defaults=r,this._name=i,this.geocoder=new google.maps.Geocoder,this._init()}var i="googleMap",r=(e.document,{});n.prototype={_init:function(){var e=this,o=new google.maps.LatLng(this.options.default_lat,this.options.default_lng),n={zoom:this.options.default_zoom,center:o,mapTypeId:google.maps.MapTypeId.ROADMAP};this.map=new google.maps.Map(this.element,n),this.addMarker(o),google.maps.event.addListener(this.marker,"dragend",function(){var t=e.marker.getPosition();e.map.panTo(t),e.updateLocation(t)}),google.maps.event.addListener(this.map,"click",function(t){e.insertMarker(t.latLng)}),this.options.search_action_el.click(t.proxy(this.searchAddress,this)),this.options.current_position_el.click(t.proxy(this.currentPosition,this)),t('[data-toggle="tab"]').on("shown.bs.tab",function(){google.maps.event.trigger(e.map,"resize")})},searchAddress:function(e){e.preventDefault();var o=this,n=this.options.search_input_el.val();this.geocoder.geocode({address:n},function(e,n){n==google.maps.GeocoderStatus.OK?(o.map.setCenter(e[0].geometry.location),o.map.setZoom(16),o.insertMarker(e[0].geometry.location)):t.isFunction(o.options.error_handler)&&o.options.error_handler(o.options.search_error_el,n)})},currentPosition:function(e){e.preventDefault();var o=this;navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){var e=new google.maps.LatLng(t.coords.latitude,t.coords.longitude);o.insertMarker(e),o.map.setCenter(e),o.map.setZoom(16)},function(e){t.isFunction(o.settings.error_handler)&&o.options.error_handler(o.options.search_error_el,e)}):t.isFunction(o.settings.error_handler)&&o.options.error_handler(o.options.search_error_el,"Your broswer does not support geolocation")},updateLocation:function(t){this.options.lat_field.val(t.lat()),this.options.lng_field.val(t.lng()),this.options.callback(t,this)},addMarker:function(t){this.marker?(this.marker.setMap(this.map),this.marker.setPosition(t)):this.marker=new google.maps.Marker({map:this.map,position:t,draggable:!0})},insertMarker:function(t){this.removeMarker(),this.addMarker(t),this.updateLocation(t)},removeMarker:function(){this.marker!=o&&this.marker.setMap(null)}},t.fn[i]=function(e){var r=arguments;if(e===o||"object"==typeof e)return this.each(function(){t.data(this,"plugin_"+i)||t.data(this,"plugin_"+i,new n(this,e))});if("string"==typeof e&&"_"!==e[0]&&"init"!==e){var a;return this.each(function(){var o=t.data(this,"plugin_"+i);o instanceof n&&"function"==typeof o[e]&&(a=o[e].apply(o,Array.prototype.slice.call(r,1))),"destroy"===e&&t.data(this,"plugin_"+i,null)}),a!==o?a:this}}}(jQuery,window);
