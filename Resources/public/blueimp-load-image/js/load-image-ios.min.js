!function(e){"use strict";"function"==typeof define&&define.amd?define(["load-image"],e):e(window.loadImage)}(function(e){"use strict";if(window.navigator&&window.navigator.platform&&/iP(hone|od|ad)/.test(window.navigator.platform)){var t=e.renderImageToCanvas;e.detectSubsampling=function(e){var t,a;return e.width*e.height>1048576?(t=document.createElement("canvas"),t.width=t.height=1,a=t.getContext("2d"),a.drawImage(e,-e.width+1,0),0===a.getImageData(0,0,1,1).data[3]):!1},e.detectVerticalSquash=function(e,t){var a,n,i,r,d,o=e.naturalHeight||e.height,g=document.createElement("canvas"),c=g.getContext("2d");for(t&&(o/=2),g.width=1,g.height=o,c.drawImage(e,0,0),a=c.getImageData(0,0,1,o).data,n=0,i=o,r=o;r>n;)d=a[4*(r-1)+3],0===d?i=r:n=r,r=i+n>>1;return r/o||1},e.renderImageToCanvas=function(a,n,i,r,d,o,g,c,m,h){if("image/jpeg"===n._type){var u,f,w,s,l=a.getContext("2d"),v=document.createElement("canvas"),I=1024,p=v.getContext("2d");if(v.width=I,v.height=I,l.save(),u=e.detectSubsampling(n),u&&(i/=2,r/=2,d/=2,o/=2),f=e.detectVerticalSquash(n,u),u||1!==f){for(r*=f,m=Math.ceil(I*m/d),h=Math.ceil(I*h/o/f),c=0,s=0;o>s;){for(g=0,w=0;d>w;)p.clearRect(0,0,I,I),p.drawImage(n,i,r,d,o,-w,-s,d,o),l.drawImage(v,0,0,I,I,g,c,m,h),w+=I,g+=m;s+=I,c+=h}return l.restore(),a}}return t(a,n,i,r,d,o,g,c,m,h)}}});
